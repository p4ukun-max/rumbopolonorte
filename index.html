<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Santa Final Landing</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #061526;
}
canvas { display:block; }
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let screenW, screenH, scale;
let SANTA_SCALE = 0.12;

function resize(){
  const dpr = window.devicePixelRatio || 1;
  screenW = window.innerWidth;
  screenH = window.innerHeight;

  canvas.width = screenW * dpr;
  canvas.height = screenH * dpr;
  canvas.style.width = screenW + "px";
  canvas.style.height = screenH + "px";

  ctx.setTransform(dpr,0,0,dpr,0,0);
  scale = Math.min(screenW / 360, 1.2);
  SANTA_SCALE = 0.12 * scale;
}
resize();
window.addEventListener("resize", resize);

/* ================= AUDIO ================= */
const sndHit = new Audio("https://assets.mixkit.co/active_storage/sfx/1109/1109-preview.mp3");
sndHit.volume = 0.6;

let snd = null;
let musicStarted = false;

function startMusic(){
  if(musicStarted) return;

  snd = new Audio("christmas.mp3");
  snd.loop = true;
  snd.volume = 0.3;

  snd.play()
    .then(() => {
      musicStarted = true;
      console.log("ðŸŽµ MÃºsica OK");
    })
    .catch(err => console.error("Audio error:", err));
}

/* ================= IMÃGENES ================= */
const santaImg = new Image();
const icebergImg = new Image();
const finalImg = new Image();

let santaReady=false, icebergReady=false, finalReady=false;

santaImg.onload = () => santaReady = true;
icebergImg.onload = () => icebergReady = true;
finalImg.onload = () => finalReady = true;

santaImg.src   = "https://www.dropbox.com/scl/fi/ncvfs2yf0v0qtvuhkbhlj/tirineo_1.png?rlkey=06psxs9942im1y7usdg0qgczb&st=wjmlwyyu&dl=1";
icebergImg.src = "https://www.dropbox.com/scl/fi/t0jk7vrotgrykx912v5le/hielo.png?rlkey=9z8pxtztv5q9ogdbpc68qet58&st=gtcq7vwj&dl=1";
finalImg.src   = "https://www.dropbox.com/scl/fi/jc6y5ao7snuzqtrbrq4cb/noel.png?rlkey=ylj0pi9uuqcti2dk3fg2hxqsv&st=kufph32f&dl=1";


/* ================= JUEGO ================= */
const santa = { x:60, y:0, w:0, h:0, vel:0 };
let pipes=[], gifts=[];
let gravity=0.45*scale, lift=-8*scale, speed=3*scale;
let started=false, count=0;
let finalPlatform=null;
let interval=null;

function createIceberg(){
  if(count>=15) return;
  const gap=240*scale, margin=80*scale;
  const top=Math.random()*(screenH-gap-margin*2)+margin;
  pipes.push({x:screenW,w:80*scale,top,bottom:top+gap});
  count++;
}

function createFinal(){
  finalPlatform={x:screenW,w:260*scale,h:380*scale};
}

function update(){
  if(!started) return;

  santa.vel+=gravity;
  santa.y+=santa.vel;

  pipes.forEach(p=>p.x-=speed);
  pipes=pipes.filter(p=>p.x+p.w>0);

  pipes.forEach(p=>{
    if(
      santa.x+santa.w>p.x &&
      santa.x<p.x+p.w &&
      (santa.y<p.top || santa.y+santa.h>p.bottom)
    ){
      sndHit.play();
      resetGame();
    }
  });

  if(count===15 && !finalPlatform) createFinal();
}

function resetGame(){
  pipes=[];
  gifts=[];
  count=0;
  finalPlatform=null;
  started=false;
  santa.vel=0;
  santa.y=screenH/2;
}

function draw(){
  ctx.fillStyle="#0b2a45";
  ctx.fillRect(0,0,screenW,screenH);

  if(!(santaReady&&icebergReady&&finalReady)){
    ctx.fillStyle="white";
    ctx.font="24px sans-serif";
    ctx.textAlign="center";
    ctx.fillText("Cargando...",screenW/2,screenH/2);
    return;
  }

  pipes.forEach(p=>{
    ctx.drawImage(icebergImg,p.x,p.bottom,p.w,screenH-p.bottom);
    ctx.save();
    ctx.translate(p.x,p.top);
    ctx.scale(1,-1);
    ctx.drawImage(icebergImg,0,0,p.w,p.top);
    ctx.restore();
  });

  santa.w=santaImg.naturalWidth*SANTA_SCALE;
  santa.h=santaImg.naturalHeight*SANTA_SCALE;
  ctx.drawImage(santaImg,santa.x,santa.y,santa.w,santa.h);

  if(!started){
    ctx.fillStyle="white";
    ctx.font="22px sans-serif";
    ctx.fillText("ðŸ”Š Toca la pantalla para empezar",screenW/2,screenH/2);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ================= INPUT ================= */
function input(){
  startMusic();
  if(!started){
    started=true;
    interval=setInterval(createIceberg,1800);
  }
  santa.vel=lift;
}

/* EVENTOS COMPATIBLES MÃ“VIL + PC */
document.addEventListener("touchstart", input, { once:true });
document.addEventListener("click", input, { once:true });
</script>
</body>
</html>
