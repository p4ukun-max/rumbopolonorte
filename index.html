<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Rumbo al Polo Norte</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#061526;
  font-family:system-ui,sans-serif;
}
canvas{display:block}

/* ===== LOADING ===== */
#loadingScreen{
  position:fixed;
  inset:0;
  background:radial-gradient(circle,#0b4d2c,#061526);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:50;
  color:white;
}
.spinner{
  width:48px;height:48px;
  border:5px solid rgba(255,255,255,.2);
  border-top-color:#7fffd4;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:16px;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== MENÃš (UNA VEZ) ===== */
#startMenu{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:white;
  z-index:20;
}
.santaOptions{
  display:flex;
  gap:14px;
  margin-bottom:24px;
}
.santaOption{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
  font-size:14px;
}
.santaOption span{opacity:.85}
.santaOptions img{
  width:60px;
  padding:4px;
  border-radius:14px;
  cursor:pointer;
  background:rgba(255,255,255,.15);
}
.santaOptions img.selected{
  background:white;
  box-shadow:0 0 16px #7fffd4;
}
#startBtn{
  font-size:20px;
  padding:14px 36px;
  border-radius:30px;
  border:none;
}
</style>
</head>

<body>

<div id="loadingScreen">
  <div class="spinner"></div>
  <p>Cargando magia navideÃ±aâ€¦</p>
</div>

<div id="startMenu">
  <h1>ðŸŽ„ Rumbo al Polo Norte âœ¨</h1>

  <div class="santaOptions">
    <div class="santaOption"><img><span>Aleatorio</span></div>
    <div class="santaOption"><img><span>Boris</span></div>
    <div class="santaOption"><img><span>Lluna</span></div>
    <div class="santaOption"><img><span>Pitufa</span></div>
  </div>

  <button id="startBtn" disabled>Iniciar Juego</button>
</div>

<canvas id="game"></canvas>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let W,H;

function resize(){
  const dpr = Math.min(devicePixelRatio||1,2);
  W = innerWidth;
  H = innerHeight;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  canvas.style.width = W+"px";
  canvas.style.height = H+"px";
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
addEventListener("resize",resize);

/* ===== AUDIO ===== */
let music=null;
function startMusic(){
  if(music) return;
  music = new Audio("christmas.mp3");
  music.loop = true;
  music.volume = 0.4;
  music.play().catch(()=>{});
}

/* ===== IMÃGENES ===== */
const preview=[
  "https://www.dropbox.com/scl/fi/9wfq8we1wn0kdrnjxz52x/random.png?dl=1",
  "https://www.dropbox.com/scl/fi/njdnkyqh8vfr0skbgt3f5/boris.png?dl=1",
  "https://www.dropbox.com/scl/fi/kmh8kxrpmfbqekxhnmbga/lluna.png?dl=1",
  "https://www.dropbox.com/scl/fi/l01xkq152sww7j6kat85c/pitufa.png?dl=1"
];

const santas=[
  "https://www.dropbox.com/scl/fi/h4usenwnm66m3s4mbpgsj/trineo_1.png?dl=1",
  "https://www.dropbox.com/scl/fi/05dnhea63myd1guwnotqi/trineo_3.png?dl=1",
  "https://www.dropbox.com/scl/fi/ncvfs2yf0v0qtvuhkbhlj/tirineo_2.png?dl=1"
];

const santaImg=new Image();
const icebergImg=new Image();
icebergImg.src="https://www.dropbox.com/scl/fi/t0jk7vrotgrykx912v5le/hielo.png?dl=1";

/* ===== PRECARGA ===== */
let loaded=0;
const total=preview.length+santas.length+1;
function assetLoaded(){
  loaded++;
  if(loaded>=total){
    loadingScreen.style.display="none";
    startBtn.disabled=false;
  }
}
[...preview,...santas,icebergImg.src].forEach(src=>{
  const i=new Image();
  i.onload=i.onerror=assetLoaded;
  i.src=src;
});

/* ===== SELECTOR ===== */
let selected=0;
const opts=document.querySelectorAll(".santaOption img");
opts.forEach((img,i)=>{
  img.src=preview[i];
  img.onclick=()=>{
    opts.forEach(o=>o.classList.remove("selected"));
    img.classList.add("selected");
    selected=i;
  };
});
opts[0].classList.add("selected");

function getSantaSprite(i){
  if(i===0) return santas[Math.floor(Math.random()*3)];
  return santas[i-1];
}

/* ===== JUEGO ===== */
const santa={x:60,y:0,w:120,h:90,vel:0};
let pipes=[], started=false, passed=0;
let icebergInterval=null;

/* ===== ICEBERGS ===== */
function createIceberg(){
  if(!started) return;
  const gap=230;
  const top=Math.random()*(H-gap-120)+60;
  pipes.push({x:W,w:60,top,bottom:top+gap});
}

/* ===== COLISIONES ===== */
function checkCollision(){
  if(santa.y<0 || santa.y+santa.h>H) return true;
  for(const p of pipes){
    if(
      santa.x+santa.w>p.x &&
      santa.x<p.x+p.w &&
      (santa.y<p.top || santa.y+santa.h>p.bottom)
    ) return true;
  }
  return false;
}

/* ===== RESET PARTIDA (SIN MENÃš) ===== */
function resetGame(){
  pipes=[];
  passed=0;
  santa.y=H/2;
  santa.vel=0;
}

/* ===== LOOP ===== */
function update(){
  if(!started) return;

  santa.vel+=0.35;
  santa.y+=santa.vel;

  if(checkCollision()){
    resetGame();
    return;
  }

  pipes.forEach(p=>p.x-=2.2);
  pipes=pipes.filter(p=>p.x+p.w>0);
}

function draw(){
  ctx.fillStyle="#061526";
  ctx.fillRect(0,0,W,H);

  pipes.forEach(p=>{
    ctx.drawImage(icebergImg,p.x,p.bottom,p.w,H-p.bottom);
    ctx.save();
    ctx.translate(p.x,p.top);
    ctx.scale(1,-1);
    ctx.drawImage(icebergImg,0,0,p.w,p.top);
    ctx.restore();
  });

  ctx.drawImage(santaImg,santa.x,santa.y,santa.w,santa.h);
}

(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();

/* ===== INPUT ===== */
addEventListener("pointerdown",()=>{
  if(started) santa.vel=-7;
});

/* ===== START (UNA VEZ) ===== */
startBtn.onclick=()=>{
  startMusic();
  startMenu.style.display="none";
  santaImg.src=getSantaSprite(selected);
  resetGame();
  started=true;

  if(icebergInterval) clearInterval(icebergInterval);
  icebergInterval=setInterval(createIceberg,1800);
};
</script>

</body>
</html>
