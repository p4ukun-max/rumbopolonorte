<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Rumbo al Polo Norte</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: #061526;
  font-family: sans-serif;
}
canvas { display: block; }

#soundOverlay {
  position: fixed;
  inset: 0;
  background: rgba(6,21,38,.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}
#soundBtn {
  font-size: 22px;
  padding: 16px 28px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
}
</style>
</head>

<body>

<div id="soundOverlay">
  <button id="soundBtn">ðŸ”Š Activar mÃºsica</button>
</div>

<canvas id="game"></canvas>

<script>
/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let screenW, screenH, scale;
let gravity = 0, lift = 0, speed = 0;
let SANTA_SCALE = 0.12;

function resize() {
  const dpr = window.devicePixelRatio || 1;
  screenW = innerWidth;
  screenH = innerHeight;

  canvas.width = screenW * dpr;
  canvas.height = screenH * dpr;
  canvas.style.width = screenW + "px";
  canvas.style.height = screenH + "px";
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

  scale = Math.min(screenW / 360, 1.2);
  SANTA_SCALE = 0.12 * scale;

  gravity = 0.45 * scale;
  lift = -8 * scale;
  speed = 3 * scale;
}
resize();
addEventListener("resize", resize);

/* ================= AUDIO ================= */
let snd = null, audioUnlocked = false;
const sndHit = new Audio("https://assets.mixkit.co/active_storage/sfx/1109/1109-preview.mp3");
sndHit.volume = .6;

function unlockAudio() {
  if (audioUnlocked) return;
  snd = new Audio("christmas.mp3");
  snd.loop = true;
  snd.volume = .3;
  snd.play().then(() => {
    audioUnlocked = true;
    document.getElementById("soundOverlay").style.display = "none";
  }).catch(()=>{});
}
document.getElementById("soundBtn").onclick = unlockAudio;

/* ================= IMÃGENES ================= */
const santaImg = new Image();
const icebergImg = new Image();
const finalImg = new Image();

let ready = { santa:false, iceberg:false, final:false };
santaImg.onload = () => ready.santa = true;
icebergImg.onload = () => ready.iceberg = true;
finalImg.onload = () => ready.final = true;

santaImg.src   = "https://www.dropbox.com/scl/fi/ncvfs2yf0v0qtvuhkbhlj/tirineo_1.png?rlkey=06psxs9942im1y7usdg0qgczb&st=wjmlwyyu&dl=1";
icebergImg.src = "https://www.dropbox.com/scl/fi/t0jk7vrotgrykx912v5le/hielo.png?rlkey=9z8pxtztv5q9ogdbpc68qet58&st=gtcq7vwj&dl=1";
finalImg.src   = "https://www.dropbox.com/scl/fi/jc6y5ao7snuzqtrbrq4cb/noel.png?rlkey=ylj0pi9uuqcti2dk3fg2hxqsv&st=kufph32f&dl=1";

/* ================= JUEGO ================= */
const santa = { x: 60, y: 0, w: 0, h: 0, vel: 0 };
let pipes = [];
let gifts = [];
let started = false;
let finished = false;
let count = 0;
let interval = null;

/* ================= ICEBERGS ================= */
function createIceberg() {
  if (count >= 15) {
    finished = true;
    clearInterval(interval);
    interval = setInterval(dropGift, 250);
    return;
  }

  const gap = 240 * scale;
  const margin = 80 * scale;
  const top = Math.random() * (screenH - gap - margin*2) + margin;

  pipes.push({
    x: screenW,
    w: 80 * scale,
    top,
    bottom: top + gap
  });

  count++;
}

/* ================= REGALOS ================= */
function dropGift() {
  gifts.push({
    x: santa.x + santa.w / 2 - 10 * scale,
    y: santa.y + santa.h,
    size: 20 * scale,
    speed: 2 + Math.random() * 2
  });
}

/* ================= UPDATE ================= */
function update() {
  if (!started) return;

  santa.vel += gravity;
  santa.y += santa.vel;

  pipes.forEach(p => p.x -= speed);
  pipes = pipes.filter(p => p.x + p.w > 0);

  if (!finished) {
    pipes.forEach(p => {
      if (
        santa.x + santa.w > p.x &&
        santa.x < p.x + p.w &&
        (santa.y < p.top || santa.y + santa.h > p.bottom)
      ) {
        sndHit.play();
        location.reload();
      }
    });
  }

  if (finished) {
    const finalH = finalImg.naturalHeight * scale;
    const floorY = screenH - finalH + finalH;

    gifts.forEach(g => g.y += g.speed);
    gifts = gifts.filter(g => g.y < floorY);
  }
}

/* ================= DRAW ================= */
function draw() {
  ctx.fillStyle = "#0b2a45";
  ctx.fillRect(0,0,screenW,screenH);

  if (!ready.santa || !ready.iceberg || !ready.final) {
    ctx.fillStyle = "#fff";
    ctx.font = "24px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText("Cargando...", screenW/2, screenH/2);
    return;
  }

  pipes.forEach(p => {
    ctx.drawImage(icebergImg, p.x, p.bottom, p.w, screenH - p.bottom);
    ctx.save();
    ctx.translate(p.x, p.top);
    ctx.scale(1,-1);
    ctx.drawImage(icebergImg,0,0,p.w,p.top);
    ctx.restore();
  });

  santa.w = santaImg.naturalWidth * SANTA_SCALE;
  santa.h = santaImg.naturalHeight * SANTA_SCALE;
  ctx.drawImage(santaImg, santa.x, santa.y, santa.w, santa.h);

  if (finished) {
    const fw = finalImg.naturalWidth * scale;
    const fh = finalImg.naturalHeight * scale;
    const fx = screenW/2 - fw/2;
    const fy = screenH - fh;
    ctx.drawImage(finalImg, fx, fy, fw, fh);

    ctx.fillStyle = "#ff3b3b";
    gifts.forEach(g => ctx.fillRect(g.x, g.y, g.size, g.size));
  }

  if (!started) {
    ctx.fillStyle = "#fff";
    ctx.font = "22px sans-serif";
    ctx.fillText("Toca para empezar", screenW/2, screenH/2);
  }
}

/* ================= LOOP ================= */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ================= INPUT ================= */
addEventListener("pointerdown", () => {
  if (!audioUnlocked) return;

  if (!started) {
    started = true;
    santa.y = screenH / 2;
    interval = setInterval(createIceberg, 1800);
  }
  santa.vel = lift;
});
</script>

</body>
</html>
