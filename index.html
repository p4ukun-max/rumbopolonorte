<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Rumbo al Polo Norte</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#061526;
  font-family:system-ui,sans-serif;
}
canvas{display:block}
#loadingScreen{
  position:fixed; inset:0;
  background:radial-gradient(circle,#0b4d2c,#061526);
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  z-index:50; color:white;
}
.spinner{
  width:48px;height:48px;
  border:5px solid rgba(255,255,255,.2);
  border-top-color:#7fffd4;
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#startMenu{
  position:fixed; inset:0;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  color:white; z-index:20;
}
.santaOptions{display:flex; gap:14px; margin-bottom:20px;}
.santaOption{display:flex; flex-direction:column; align-items:center; gap:6px;}
.santaOption span{opacity:.85}
.santaOptions img{
  width:60px; padding:4px;
  border-radius:14px; cursor:pointer;
  background:rgba(255,255,255,.15);
}
.santaOptions img.selected{
  background:white;
  box-shadow:0 0 16px #7fffd4;
}
#startBtn{
  font-size:20px;
  padding:14px 36px;
  border-radius:30px;
  border:none;
}
</style>
</head>

<body>

<div id="loadingScreen">
  <div class="spinner"></div>
  <p>Cargando magia navide√±a‚Ä¶‚ú®üéÑ</p>
</div>

<div id="startMenu">
  <h1>üéÑ Rumbo al Polo Norte ‚ú®</h1>
  <div class="santaOptions">
    <div class="santaOption"><img><span>Aleatorio</span></div>
    <div class="santaOption"><img><span>Boris</span></div>
    <div class="santaOption"><img><span>Lluna</span></div>
    <div class="santaOption"><img><span>Pitufa</span></div>
    <div class="santaOption"><img><span>Pancho</span></div>
  </div>
  <button id="startBtn">Iniciar Juego</button>
</div>

<canvas id="game"></canvas>

<script>
const gifts = [];
function throwGift() {
  if (!finalPlatform) return;

  gifts.push({
    t: 0,
    speed: 0.02 + Math.random() * 0.01,

    startX: santa.x + santa.w / 2,
    startY: santa.y + santa.h / 2,

    endX: finalPlatform.x + finalPlatform.w / 2 + (Math.random() * 80 - 40),
    endY: finalPlatform.y + 80,

    arc: 120 + Math.random() * 60, // altura del arco
    size: 22 + Math.random() * 8
  });
}

const startBtn = document.getElementById("startBtn");
let screenW = 0;
let screenH = 0;
const TOTAL_ICEBERGS = 10;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
/* ===== CANVAS ===== */
function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;

    screenW = window.innerWidth;
    screenH = window.innerHeight;

    canvas.width  = screenW * dpr;
    canvas.height = screenH * dpr;

    canvas.style.width  = screenW + "px";
    canvas.style.height = screenH + "px";

    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}

resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ===== AUDIO ===== */
let music=null;
function startMusic(){
  if(music) return;
  music=new Audio("christmas.mp3");
  music.loop=true; music.volume=0.2;
  music.play().catch(()=>{});
}

/* üñºÔ∏è PREVIEW MEN√ö */
const preview = [
  "https://www.dropbox.com/scl/fi/9wfq8we1wn0kdrnjxz52x/random.png?rlkey=ls3zowk6kued1v1jw4cryqpsq&st=wudgp52c&dl=1",
  "https://www.dropbox.com/scl/fi/njdnkyqh8vfr0skbgt3f5/boris.png?rlkey=60d8i2gjcato556v9t43ajatm&st=wxv9k7cs&dl=1",
  "https://www.dropbox.com/scl/fi/kmh8kxrpmfbqekxhnmbga/lluna.png?rlkey=96fqlv18dkmfnbwumitzswdjd&st=ui4log4o&dl=1",
  "https://www.dropbox.com/scl/fi/l01xkq152sww7j6kat85c/pitufa.png?rlkey=93p5098lqfkgvfet9oo6oze0l&st=skuxk9x4&dl=1",
   "https://www.dropbox.com/scl/fi/rk23bhpjxym2u4bg7yrwv/pancho.png?rlkey=2crqukwh1r6jmg9ec9ru27bdo&st=4ozx3sdz&dl=1"
];

/* üéÆ SPRITES JUEGO (MISMO ORDEN) */
const santas = [
  "https://www.dropbox.com/scl/fi/h4usenwnm66m3s4mbpgsj/trineo_1.png?rlkey=pc6ou62aiu5216c1ihhc2875e&st=m336zbwp&dl=1",
  "https://www.dropbox.com/scl/fi/05dnhea63myd1guwnotqi/trineo_3.png?rlkey=rnjdap710lpar3o2ot79eh89p&st=yogg44ow&dl=1",
  "https://www.dropbox.com/scl/fi/ncvfs2yf0v0qtvuhkbhlj/tirineo_2.png?rlkey=06psxs9942im1y7usdg0qgczb&st=mnb73xe4&dl=1",
  "https://www.dropbox.com/scl/fi/75e3f1h3f5sx24l8qnwg1/trineo_4.png?rlkey=gpspe271fp9zlmje3bzb57jwa&st=0x6fxism&dl=1"
];
const santaImg=new Image();
santaImg.onload = resizeSanta;
const icebergImg=new Image();
const finalImg=new Image();
icebergImg.src = "https://www.dropbox.com/scl/fi/t0jk7vrotgrykx912v5le/hielo.png?rlkey=9z8pxtztv5q9ogdbpc68qet58&st=6cffxunf&dl=1";
finalImg.src   = "https://www.dropbox.com/scl/fi/jc6y5ao7snuzqtrbrq4cb/noel.png?rlkey=ylj0pi9uuqcti2dk3fg2hxqsv&st=48f5n9oi&dl=1";
/* ===== SELECTOR ===== */
let selectedSanta = 0; // 0 = aleatorio
document.querySelectorAll(".santaOption img").forEach((img, i) => {
  img.src = preview[i];

  img.onclick = () => {
    document.querySelectorAll(".santaOption img")
      .forEach(o => o.classList.remove("selected"));

    img.classList.add("selected");
    selectedSanta = i; // 0,1,2,3
  };
});
function getSantaSprite() {
  let index;

  if (selectedSanta === 0) {
    // Aleatorio entre 1, 2 y 3, 4
    index = Math.floor(Math.random() * 4) + 1;
  } else {
    index = selectedSanta;
  }

  // Convertimos 1,2,3 ‚Üí 0,1,2,3
  return santas[index - 1];
}



/* ===== PRECARGA ===== */

let assetsLoaded = 0;
const TOTAL_ASSETS = preview.length + santas.length + 2;;

function assetLoaded() {
  assetsLoaded++;
  if (assetsLoaded >= TOTAL_ASSETS) {
    document.getElementById("loadingScreen").style.display = "none";
  }
}
[...preview,...santas,icebergImg.src,finalImg.src].forEach(src=>{
  const i=new Image();
  i.onload=i.onerror=assetLoaded;
  i.src=src;
});

/* ===== AURORA (ORIGINAL) ===== */
let aurora=false, auroraAlpha=0, auroraT=0, auroraState="fadeIn", auroraTimer=0, auroraBaseY=0;
setInterval(()=>{
  aurora=true; auroraAlpha=0; auroraState="fadeIn"; auroraTimer=0;
  auroraBaseY=screenH*(0.1+Math.random()*0.3);
},7000);

function drawAurora(){
  if(!aurora) return;
  auroraT+=0.015;
  if(auroraState==="fadeIn"){auroraAlpha+=0.01;if(auroraAlpha>=0.7){auroraState="visible";}}
  else if(auroraState==="visible"){if(++auroraTimer>180) auroraState="fadeOut";}
  else if(auroraState==="fadeOut"){auroraAlpha-=0.006;if(auroraAlpha<=0){aurora=false;return;}}
  const topY=auroraBaseY, bottomY=topY+screenH*0.35;
  ctx.save(); ctx.globalAlpha=auroraAlpha;
  const g=ctx.createLinearGradient(0,topY,0,bottomY);
  g.addColorStop(0,"rgba(120,255,200,.45)");
  g.addColorStop(1,"rgba(180,120,255,.05)");
  ctx.fillStyle=g;
  ctx.beginPath(); ctx.moveTo(0,topY);
  for(let x=0;x<=screenW;x+=10) ctx.lineTo(x,topY+Math.sin(x*0.01+auroraT)*35);
  for(let x=screenW;x>=0;x-=10) ctx.lineTo(x,bottomY+Math.sin(x*0.008+auroraT+2)*25);
  ctx.closePath(); ctx.fill(); ctx.restore();
}

/* ===== NIEVE ===== */
const snow=[];
for(let i=0;i<80;i++) snow.push({x:Math.random()*screenW,y:Math.random()*screenH,r:Math.random()*2+1,s:Math.random()*1.2+.4});
function drawSnow(){
  ctx.fillStyle="white";
  snow.forEach(f=>{
    f.y+=f.s; if(f.y>screenH){f.y=-10;f.x=Math.random()*screenW;}
    ctx.beginPath(); ctx.arc(f.x,f.y,f.r,0,Math.PI*2); ctx.fill();
  });
}

/* ===== JUEGO ===== */
let santa = { x: 100, y: 0, w: 70, h: 50, vel: 0 };
let pipes = [];
let gravity = 0.45;
let lift = -8;
let started = false;
let finished = false;
let gameOver = false;
let icebergCount = 0;
let finalPlatform = null;
//reset santa
function resetSanta() {
    santa.y = screenH / 2 - santa.h / 2;
    santa.vel = 0;
}
resetSanta();
/* ===== ICEBERGS (M√ÅS JUSTO) ===== */
function createIceberg() {
    if (icebergCount >= TOTAL_ICEBERGS || gameOver) return;

    let gap = 260;
    let top = Math.random() * (screenH - gap - 220) + 100;

    pipes.push({
        x: screenW,
        w: 90,
        top,
        bottom: top + gap
    });

    icebergCount++;
}
/* ===== COLISI√ìN ===== */
function checkCollision() {

  for (const p of pipes) {
    const hitsX =
      santa.x + santa.w > p.x &&
      santa.x < p.x + p.w;

    if (hitsX) {
      // colisi√≥n arriba o abajo
      if (
        santa.y < p.top ||
        santa.y + santa.h > p.bottom
      ) {
        return true; // üíÄ MUERTE
      }
    }
  }

  return false;
}

// ================== FINAL ==================
function createFinalPlatform() {

  const scale = Math.min(screenW / 420, 1);

  let ratio = 0.7; // fallback
  if (finalImg.complete && finalImg.naturalHeight > 0) {
    ratio = finalImg.naturalWidth / finalImg.naturalHeight;
  }

  const h = 320 * scale;   // tama√±o visual final
  const w = h * ratio;

  finalPlatform = {
    w,
    h,
    x: screenW,
    y: screenH - h - 10
  };
}
//update
let victoryPlayed = false;
let victoryMusic = null;
function update() {
	if (!started || assetsLoaded < TOTAL_ASSETS) return;

    if (!gameOver) {
	  santa.vel += gravity;
	  santa.y += santa.vel;
	}

    pipes.forEach(p => p.x -= 2);

    pipes.forEach(p => {
        if (
            santa.x + santa.w > p.x &&
            santa.x < p.x + p.w &&
            (santa.y < p.top || santa.y + santa.h > p.bottom)
        ) {
            gameOver = true;
        }
    });

    pipes = pipes.filter(p => p.x + p.w > 0);

    if (icebergCount === TOTAL_ICEBERGS && !finalPlatform) createFinalPlatform();

    if (finalPlatform && !gameOver) {
        finalPlatform.x -= 3;
        if (finalPlatform.x <= santa.x + 20) {
            finished = true;
            pipes = [];
			if (!victoryPlayed) {
				victoryPlayed = true;
				music?.pause();

				victoryMusic = new Audio("victory.mp3");
				victoryMusic.volume = 0.4;
				victoryMusic.play().catch(()=>{});
			  }
        }
    }
	if (finished && Math.random() < 0.15) {
	  throwGift();
	}

	gifts.forEach(g => {
	  g.t += g.speed;
	});

	// eliminar regalos que llegaron
	for (let i = gifts.length - 1; i >= 0; i--) {
	  if (gifts[i].t >= 1) {
		gifts.splice(i, 1);
	  }
	}
	if (finished && finalPlatform) {
	  finalPlatform.x = santa.x + santa.w - finalPlatform.w * 0.35;
	}	
		// ‚õî L√≠mites tras llegar al final
	if (finished) {
	  if (santa.y < 0) {
		santa.y = 0;
		santa.vel = 0;
	  }
	  const ground = screenH - santa.h - 10;
	  if (santa.y > ground) {
		santa.y = ground;
		santa.vel = 0;
	  }
	}
}
// ================== LOOP ==================
function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}


/* ================= DRAW ================= */
function draw() {
    ctx.clearRect(0, 0, screenW, screenH);

    drawAurora();   // üåà aurora al fondo
    drawSnow();     // ‚ùÑÔ∏è nieve encima
    if (assetsLoaded < TOTAL_ASSETS) {
        ctx.fillStyle = "white";
        ctx.font = "22px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("Cargando...", screenW / 2, screenH / 2);
        ctx.textAlign = "left";
        return;
    }

    pipes.forEach(p => {
        ctx.save();
        ctx.translate(p.x, p.top);
        ctx.scale(1, -1);
        ctx.drawImage(icebergImg, 0, 0, p.w, p.top);
        ctx.restore();

        ctx.drawImage(
            icebergImg,
            p.x,
            p.bottom,
            p.w,
            screenH - p.bottom
        );
    });

    if (finalPlatform) {
        ctx.drawImage(finalImg, finalPlatform.x, finalPlatform.y, finalPlatform.w, finalPlatform.h);
    }
	if (!santaImg.src) return;
    ctx.drawImage(santaImg, santa.x, santa.y, santa.w, santa.h);
	gifts.forEach(g => {
	  const t = g.t;

	  // interpolaci√≥n horizontal
	  const x = g.startX + (g.endX - g.startX) * t;

	  // interpolaci√≥n vertical con arco
	  const y =
		g.startY +
		(g.endY - g.startY) * t -
		Math.sin(Math.PI * t) * g.arc;

	  ctx.font = `${g.size}px serif`;
	  ctx.textAlign = "center";
	  ctx.fillText("üéÅ", x, y);
	});

	ctx.textAlign = "left";
    if (!started) {
        ctx.fillStyle = "white";
        ctx.font = "24px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(
            "Toca para mantener el equilibrio del trineo",
            screenW / 2,
            screenH / 2 + 120
        );
        ctx.textAlign = "left";
    }

    if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "32px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("üí• GAME OVER üí•", screenW / 2, screenH / 2);
        ctx.font = "18px sans-serif";
        ctx.fillText("Toca para reiniciar", screenW / 2, screenH / 2 + 40);
        ctx.textAlign = "left";
    }

    if (finished) {
        ctx.fillStyle = "white";
        ctx.font = "30px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("¬°Entrega completada! üéÖüéÅ", screenW / 2, 80);
        ctx.textAlign = "left";
    }
}


// ================== CONTROLES (M√ìVIL + PC) ==================
let icebergInterval;
let inputLocked = false;

function handleInput() {

  if (gameOver) {
    victoryPlayed = false;
    victoryMusic?.pause();
    victoryMusic = null;
    pipes = [];
    icebergCount = 0;
    gifts.length = 0;
    finalPlatform = null;
    gameOver = false;
    finished = false;
    started = false;
    showHint = true;       // üëà vuelve a aparecer SIEMPRE
    clearInterval(icebergInterval);
    resetSanta();
    return;
  }

  if (!started) {
    started = true;       // üëà AQU√ç empieza la partida
    showHint = false;     // üëà se oculta el mensaje
    icebergInterval = setInterval(createIceberg, 2600);
  }

  santa.vel = lift;
}

startBtn.onclick = () => {
  victoryPlayed = false;
  victoryMusic?.pause();
  victoryMusic = null;
  gifts.length = 0;
  icebergCount = 0;
  finalPlatform = null;
  gameOver = false;
  finished = false;
  clearInterval(icebergInterval);
  resetSanta();
  document.getElementById("startMenu").style.display = "none";
  santaImg.src = getSantaSprite();
  startMusic();
  started = false;    
  showHint = true;    
};
document.addEventListener("pointerdown", handleInput);
resizeSanta();
window.addEventListener("resize", resizeSanta);
function resizeSanta() {
  const scale = Math.min(screenW / 420, 1);

  // La altura manda
  santa.h = 90 * scale;

  // El ancho se calcula seg√∫n la proporci√≥n real de la imagen
  if (santaImg.complete && santaImg.naturalHeight > 0) {
    santa.w = santa.h * (santaImg.naturalWidth / santaImg.naturalHeight);
  } else {
    santa.w = santa.h * 2.5; // fallback seguro
  }
}
loop();

</script>

</body>
</html>



